# Discord ポモドーロタイマーボット

Discordのボイスチャンネルでポモドーロテクニックを実践するためのボットです。

## 機能

- 🍅 **ポモドーロタイマー**: 25分の集中時間と5分の休憩時間を4サイクル実行
- 🔇 **自動ミュート**: 集中時間中はボイスチャンネルの全メンバーをミュート
- 🔊 **自動アンミュート**: 休憩時間中はミュートを解除
- ⏸️ **一時停止/再開**: セッション中にタイマーを一時停止・再開可能
- ⏹️ **強制停止**: セッションを途中で停止可能
- 📊 **リアルタイム表示**: 残り時間をリアルタイムで更新表示
- 👥 **途中参加対応**: セッション中にボイスチャンネルに参加した場合も適切にミュート処理
- 🔄 **同時実行**: 複数のボイスチャンネルで同時にセッション実行可能

## インストール

### 1. リポジトリをクローン

```bash
git clone <your-repository-url>
cd pomodoro-discord-bot
```

### 2. 依存関係をインストール

```bash
npm install
```

### 3. Discord Botの作成とセットアップ

#### 3.1 Discord Developer Portalでボットを作成

1. [Discord Developer Portal](https://discord.com/developers/applications) にアクセス
2. 「New Application」をクリックしてアプリケーションを作成
3. アプリケーション名を入力（例：「Pomodoro Timer Bot」）

#### 3.2 ボットトークンを取得

1. 左サイドバーの「Bot」をクリック
2. 「Reset Token」をクリックしてボットトークンを生成
3. トークンをコピーして保存（このトークンは秘密にしてください）

#### 3.3 必要な権限を設定

1. 左サイドバーの「OAuth2」→「URL Generator」をクリック
2. **Scopes**で以下を選択：
   - `bot`
   - `applications.commands`
3. **Bot Permissions**で以下を選択：
   - `Send Messages`
   - `Use Slash Commands`
   - `Connect`
   - `Speak`
   - `Mute Members`
   - `Move Members`

#### 3.4 ボットをサーバーに招待

1. 生成されたURLをコピー
2. URLにアクセスしてボットをDiscordサーバーに招待
3. 適切な権限があることを確認

### 4. 環境変数の設定

`.env.example`を`.env`にコピーして設定：

```bash
cp .env.example .env
```

`.env`ファイルを編集：

```env
DISCORD_TOKEN=あなたのボットトークン
CLIENT_ID=あなたのアプリケーションクライアントID
```

**Client IDの取得方法**：
1. Discord Developer Portalの「General Information」タブ
2. 「Application ID」をコピー

### 5. ボットを起動

```bash
npm start
```

開発環境（自動再起動）：

```bash
npm run dev
```

## 使用方法

### 基本的な使い方

1. ボイスチャンネルに参加
2. `/pomodoro` コマンドを実行
3. ボタンでタイマーを操作

### コマンド

- `/pomodoro [channel]` - ポモドーロセッションを開始
  - `channel` (オプション): 対象のボイスチャンネルを指定
  - チャンネルを指定しない場合は、コマンド実行者が参加しているボイスチャンネルが対象

### 使用例

```
# 現在参加しているボイスチャンネルでセッション開始
/pomodoro

# 特定のボイスチャンネルを指定してセッション開始
/pomodoro channel:#study-room
```

### ボタン操作

セッション開始後、以下のボタンでタイマーを操作できます：

- ⏸️ **一時停止** - タイマーを一時停止
- ▶️ **再開** - 一時停止中のタイマーを再開
- ⏹️ **停止** - セッションを強制終了

### ステータス表示

セッション中は以下の情報がリアルタイムで表示されます：

- 現在のフェーズ（集中時間 🍅 / 休憩時間 ☕）
- 現在のサイクル数（例：サイクル 2/4）
- 残り時間（例：23:45）
- タイマーの状態（実行中 ▶️ / 一時停止中 ⏸️）
- 対象のボイスチャンネル名

## タイマーの動作

### デフォルト設定
- 集中時間: 25分
- 休憩時間: 5分
- サイクル数: 4回

### セッションの流れ
1. 🍅 サイクル1 集中時間 (25分) - 全員ミュート
2. ☕ サイクル1 休憩時間 (5分) - ミュート解除
3. 🍅 サイクル2 集中時間 (25分) - 全員ミュート
4. ☕ サイクル2 休憩時間 (5分) - ミュート解除
5. 🍅 サイクル3 集中時間 (25分) - 全員ミュート
6. ☕ サイクル3 休憩時間 (5分) - ミュート解除
7. 🍅 サイクル4 集中時間 (25分) - 全員ミュート
8. 🎉 セッション完了

## 注意事項とトラブルシューティング

### 必要な権限
- ボットには以下の権限が必要です：
  - `Send Messages` - メッセージ送信
  - `Use Slash Commands` - スラッシュコマンド使用
  - `Connect` - ボイスチャンネル接続
  - `Speak` - ボイスチャンネル発言
  - `Mute Members` - メンバーのミュート（最重要）
  - `Move Members` - メンバーの移動

### 制限事項
- 1つのボイスチャンネルで同時に実行できるセッションは1つだけです
- セッション中にボイスチャンネルに参加した場合、集中時間中は自動的にミュートされます
- ボットがボイスチャンネルにアクセスできない場合はセッションを開始できません

### よくある問題

#### ボットが反応しない
1. ボットがオンラインになっているか確認
2. 必要な権限が付与されているか確認
3. コンソールのエラーログを確認

#### ミュートが機能しない
1. ボットに「Mute Members」権限があるか確認
2. ボットの役職がユーザーの役職より上位にあるか確認
3. サーバーの権限設定を確認

#### セッションが開始できない
- 対象のボイスチャンネルにメンバーがいるか確認
- 既に同じチャンネルでセッションが実行中でないか確認
- ボットがそのチャンネルにアクセス権限を持っているか確認

## ライセンス

MIT License